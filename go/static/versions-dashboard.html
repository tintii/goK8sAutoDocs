<!DOCTYPE html>
<html>
<head>
	<title>Kubernetes Versions Dashboard</title>
	<style>
		:root {
			--bg-color: #f5f5f5;
			--container-bg: white;
			--text-color: #333;
			--border-color: #ddd;
			--header-bg: #007cba;
			--header-text: white;
			--row-bg: #f8f9fa;
			--row-hover: #e3f2fd;
			--stat-bg: #f8f9fa;
			--search-bg: #f8f9fa;
			--search-border: #e9ecef;
			--image-tag-bg: #e9ecef;
			--image-tag-text: #495057;
			--label-tag-bg: #17a2b8;
			--label-tag-text: white;
		}

		[data-theme="dark"] {
			--bg-color: #1a1a1a;
			--container-bg: #2d2d2d;
			--text-color: #e0e0e0;
			--border-color: #444;
			--header-bg: #005a8b;
			--header-text: white;
			--row-bg: #3a3a3a;
			--row-hover: #4a4a4a;
			--stat-bg: #3a3a3a;
			--search-bg: #3a3a3a;
			--search-border: #555;
			--image-tag-bg: #555;
			--image-tag-text: #e0e0e0;
			--label-tag-bg: #0d6efd;
			--label-tag-text: white;
		}

		body { 
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
			margin: 0; 
			padding: 20px; 
			background-color: var(--bg-color);
			color: var(--text-color);
			transition: background-color 0.3s ease, color 0.3s ease;
		}
		.container { 
			max-width: 1400px; 
			margin: 0 auto; 
			background: var(--container-bg); 
			border-radius: 8px; 
			box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
			padding: 20px; 
			overflow-x: auto;
			transition: background-color 0.3s ease;
		}
		h1 { 
			color: var(--text-color); 
			margin-bottom: 5px; 
			border-bottom: 3px solid var(--header-bg); 
			padding-bottom: 10px; 
			transition: color 0.3s ease;
		}
		.cluster-info { 
			text-align: center; 
			margin-bottom: 15px; 
		}
		.cluster-name { 
			display: inline-block; 
			background: var(--header-bg); 
			color: var(--header-text); 
			padding: 6px 12px; 
			border-radius: 15px; 
			font-size: 14px; 
			font-weight: 600; 
			box-shadow: 0 2px 4px rgba(0, 124, 186, 0.3); 
		}
		.theme-toggle {
			position: fixed;
			top: 20px;
			right: 20px;
			background: var(--header-bg);
			color: var(--header-text);
			border: none;
			padding: 10px 15px;
			border-radius: 20px;
			cursor: pointer;
			font-size: 14px;
			font-weight: 600;
			box-shadow: 0 2px 8px rgba(0,0,0,0.2);
			transition: all 0.3s ease;
			z-index: 1000;
		}
		.theme-toggle:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0,0,0,0.3);
		}
		.stats { 
			display: flex; 
			gap: 20px; 
			margin-bottom: 20px; 
			flex-wrap: wrap; 
		}
		.stat-card { 
			background: var(--stat-bg); 
			padding: 15px; 
			border-radius: 6px; 
			border-left: 4px solid var(--header-bg); 
			min-width: 150px; 
			transition: background-color 0.3s ease;
		}
		.stat-number { 
			font-size: 24px; 
			font-weight: bold; 
			color: var(--header-bg); 
		}
		.stat-label { 
			color: var(--text-color); 
			font-size: 14px; 
			opacity: 0.8;
		}
		table { 
			width: 100%; 
			border-collapse: collapse; 
			margin-top: 20px; 
			background: var(--container-bg); 
			table-layout: fixed;
			transition: background-color 0.3s ease;
		}
		th, td { 
			border: 1px solid var(--border-color); 
			padding: 12px; 
			text-align: left; 
			word-wrap: break-word;
			overflow-wrap: break-word;
			max-width: 0;
			transition: border-color 0.3s ease;
		}
		th { 
			background-color: var(--header-bg); 
			color: var(--header-text); 
			font-weight: 600; 
		}
		tr:nth-child(even) { 
			background-color: var(--row-bg); 
			transition: background-color 0.3s ease;
		}
		tr:hover { 
			background-color: var(--row-hover); 
		}
		.container-type { 
			display: inline-block; 
			padding: 4px 8px; 
			border-radius: 4px; 
			font-size: 12px; 
			font-weight: 500; 
		}
		.container-type.init { 
			background-color: #fff3cd; 
			color: #856404; 
		}
		.container-type.main { 
			background-color: #d1ecf1; 
			color: #0c5460; 
		}
		.resource-kind { 
			font-weight: 600; 
			color: var(--header-bg); 
		}
		.image-name { 
			font-family: 'Courier New', monospace; 
			font-size: 13px; 
			color: var(--text-color); 
		}
		.image-tag { 
			background-color: var(--image-tag-bg); 
			padding: 2px 6px; 
			border-radius: 3px; 
			font-size: 12px; 
			font-weight: 500; 
			color: var(--image-tag-text); 
			transition: background-color 0.3s ease, color 0.3s ease;
		}
		
		.image-sha {
			background-color: var(--label-tag-bg);
			color: var(--label-tag-text);
			padding: 2px 6px;
			border-radius: 3px;
			font-size: 11px;
			font-weight: 500;
			font-family: 'Courier New', monospace;
			margin-left: 4px;
		}
		
		.labels-container {
			margin-top: 4px;
			display: flex;
			flex-wrap: wrap;
			gap: 3px;
		}
		
		.label-tag {
			background-color: var(--label-tag-bg);
			color: var(--label-tag-text);
			padding: 1px 4px;
			border-radius: 2px;
			font-size: 9px;
			font-weight: 500;
		}
		.nav-links { 
			margin-bottom: 20px; 
		}
		.nav-links a { 
			color: var(--header-bg); 
			text-decoration: none; 
			margin-right: 20px; 
			transition: color 0.3s ease;
		}
		.nav-links a:hover { 
			text-decoration: underline; 
		}
		.loading { 
			text-align: center; 
			padding: 40px; 
			color: var(--text-color); 
			opacity: 0.7;
		}
		
		.search-container {
			margin: 20px 0;
			padding: 15px;
			background: var(--search-bg);
			border-radius: 8px;
			border: 1px solid var(--search-border);
			transition: background-color 0.3s ease, border-color 0.3s ease;
		}
		
		.search-input {
			width: 100%;
			padding: 12px 16px;
			border: 2px solid var(--border-color);
			border-radius: 6px;
			font-size: 16px;
			transition: border-color 0.3s ease;
			box-sizing: border-box;
			background: var(--container-bg);
			color: var(--text-color);
		}
		
		.search-input:focus {
			outline: none;
			border-color: var(--header-bg);
			box-shadow: 0 0 0 3px rgba(0, 124, 186, 0.1);
		}
		
		.search-stats {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-top: 10px;
			font-size: 14px;
			color: var(--text-color);
			opacity: 0.7;
		}
		
		.clear-search-btn {
			background: #dc3545;
			color: white;
			border: none;
			padding: 6px 12px;
			border-radius: 4px;
			cursor: pointer;
			font-size: 12px;
			transition: background-color 0.3s ease;
		}
		
		.clear-search-btn:hover {
			background: #c82333;
		}
		
		.highlight {
			background-color: #fff3cd;
			padding: 2px 4px;
			border-radius: 3px;
		}
		
		/* Responsive design for smaller screens */
		@media (max-width: 768px) {
			.container {
				margin: 10px;
				padding: 15px;
			}
			
			.stats {
				flex-direction: column;
				gap: 10px;
			}
			
			.stat-card {
				min-width: auto;
			}
			
			table {
				font-size: 12px;
			}
			
			th, td {
				padding: 8px 6px;
			}
			
			.image-name {
				font-size: 11px;
			}
			
			.image-tag {
				font-size: 10px;
			}
			
			.theme-toggle {
				top: 10px;
				right: 10px;
				padding: 8px 12px;
				font-size: 12px;
			}
		}
	</style>
</head>
<body>
	<button class="theme-toggle" id="theme-toggle">üåô Dark Mode</button>
	
	<div class="container">
		<h1>üöÄ Kubernetes Versions Dashboard</h1>
		<div class="cluster-info">
			<span class="cluster-name" id="cluster-name">Loading cluster...</span>
		</div>
		
		<div class="nav-links">
			<a href="/">‚Üê Back to Home</a>
			<a href="/api/v1/versions-dashboard">View JSON API</a>
		</div>
		
		<div class="stats">
			<div class="stat-card">
				<div class="stat-number" id="total-resources">-</div>
				<div class="stat-label">Total Resources</div>
			</div>
			<div class="stat-card">
				<div class="stat-number" id="total-containers">-</div>
				<div class="stat-label">Total Containers</div>
			</div>
			<div class="stat-card">
				<div class="stat-number" id="unique-images">-</div>
				<div class="stat-label">Unique Images</div>
			</div>
		</div>
		
		<div class="search-container">
			<input type="text" id="search-input" placeholder="Search resources, namespaces, images, tags..." class="search-input">
			<div class="search-stats">
				<span id="filtered-count">Showing all results</span>
				<button id="clear-search" class="clear-search-btn" style="display: none;">Clear Search</button>
			</div>
		</div>
		
		<div id="loading" class="loading">Loading container data...</div>
		<div id="table-container" style="display: none;">
			<table id="versions-table">
				<thead>
					<tr>
						<th>Resource Name</th>
						<th>Namespace</th>
						<th>Kind</th>
						<th>Container Name</th>
						<th>Type</th>
						<th>Image</th>
						<th>Tag</th>
						<th>SHA</th>
					</tr>
				</thead>
				<tbody id="table-body">
				</tbody>
			</table>
		</div>
	</div>

	<script>
		let allData = [];
		let filteredData = [];
		
		// Theme management
		function initTheme() {
			const savedTheme = localStorage.getItem('theme') || 'light';
			document.documentElement.setAttribute('data-theme', savedTheme);
			updateThemeButton(savedTheme);
		}
		
		function toggleTheme() {
			const currentTheme = document.documentElement.getAttribute('data-theme');
			const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
			document.documentElement.setAttribute('data-theme', newTheme);
			localStorage.setItem('theme', newTheme);
			updateThemeButton(newTheme);
		}
		
		function updateThemeButton(theme) {
			const button = document.getElementById('theme-toggle');
			if (theme === 'dark') {
				button.textContent = '‚òÄÔ∏è Light Mode';
			} else {
				button.textContent = 'üåô Dark Mode';
			}
		}
		
		// Search functionality
		function performSearch(searchTerm) {
			if (!searchTerm.trim()) {
				filteredData = allData;
				updateTable(filteredData);
				updateSearchStats(filteredData.length, allData.length);
				document.getElementById('clear-search').style.display = 'none';
				return;
			}
			
			const searchLower = searchTerm.toLowerCase();
			filteredData = allData.filter(resource => {
				// Search in resource name, namespace, kind
				if (resource.name.toLowerCase().includes(searchLower) ||
					resource.namespace.toLowerCase().includes(searchLower) ||
					resource.kind.toLowerCase().includes(searchLower)) {
					return true;
				}
				

				
				// Search in containers
				return resource.containers.some(container => {
					return container.name.toLowerCase().includes(searchLower) ||
						   container.image.toLowerCase().includes(searchLower) ||
						   container.tag.toLowerCase().includes(searchLower) ||
						   (container.sha && container.sha.toLowerCase().includes(searchLower));
				});
			});
			
			updateTable(filteredData);
			updateSearchStats(filteredData.length, allData.length);
			document.getElementById('clear-search').style.display = 'inline-block';
		}
		
		function updateTable(data) {
			const tableBody = document.getElementById('table-body');
			tableBody.innerHTML = '';
			
			data.forEach(resource => {
				resource.containers.forEach(container => {
					const row = document.createElement('tr');
					
					const containerType = container.type === 'init' ? 
						'<span class="container-type init">Init</span>' : 
						'<span class="container-type main">Main</span>';
					
					row.innerHTML = '<td><strong>' + resource.name + '</strong></td>' +
						'<td>' + resource.namespace + '</td>' +
						'<td><span class="resource-kind">' + resource.kind + '</span></td>' +
						'<td>' + container.name + '</td>' +
						'<td>' + containerType + '</td>' +
						'<td><span class="image-name">' + container.image + '</span></td>' +
						'<td><span class="image-tag">' + container.tag + '</span></td>' +
						'<td>' + container.sha + '</td>';
					
					tableBody.appendChild(row);
				});
			});
		}
		
		function updateSearchStats(filteredCount, totalCount) {
			const statsElement = document.getElementById('filtered-count');
			if (filteredCount === totalCount) {
				statsElement.textContent = 'Showing all results';
			} else {
				statsElement.textContent = `Showing ${filteredCount} of ${totalCount} results`;
			}
		}
		
		function highlightSearchTerm(text, searchTerm) {
			if (!searchTerm.trim()) return text;
			const regex = new RegExp(`(${searchTerm})`, 'gi');
			return text.replace(regex, '<span class="highlight">$1</span>');
		}
		
		// Event listeners
		document.addEventListener('DOMContentLoaded', function() {
			// Initialize theme
			initTheme();
			
			// Theme toggle
			document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
			
			const searchInput = document.getElementById('search-input');
			const clearSearchBtn = document.getElementById('clear-search');
			
			// Fetch cluster information
			fetch('/api/v1/cluster-info')
				.then(response => response.json())
				.then(data => {
					const clusterNameElement = document.getElementById('cluster-name');
					clusterNameElement.textContent = data.clusterName;
				})
				.catch(error => {
					const clusterNameElement = document.getElementById('cluster-name');
					clusterNameElement.textContent = 'Cluster: Unknown';
					console.error('Error fetching cluster info:', error);
				});
			
			// Debounced search
			let searchTimeout;
			searchInput.addEventListener('input', function() {
				clearTimeout(searchTimeout);
				searchTimeout = setTimeout(() => {
					performSearch(this.value);
				}, 300);
			});
			
			// Clear search
			clearSearchBtn.addEventListener('click', function() {
				searchInput.value = '';
				performSearch('');
			});
			
			// Keyboard shortcuts
			searchInput.addEventListener('keydown', function(e) {
				if (e.key === 'Escape') {
					this.value = '';
					performSearch('');
				}
			});
		});
		
		// Load data
		fetch('/api/v1/versions-dashboard')
			.then(response => response.json())
			.then(data => {
				allData = data;
				filteredData = data;
				
				const tableBody = document.getElementById('table-body');
				const loading = document.getElementById('loading');
				const tableContainer = document.getElementById('table-container');
				
				let totalContainers = 0;
				const uniqueImages = new Set();
				
				data.forEach(resource => {
					resource.containers.forEach(container => {
						totalContainers++;
						uniqueImages.add(container.image + ':' + container.tag);
					});
				});
				
				// Update stats
				document.getElementById('total-resources').textContent = data.length;
				document.getElementById('total-containers').textContent = totalContainers;
				document.getElementById('unique-images').textContent = uniqueImages.size;
				
				// Show table
				loading.style.display = 'none';
				tableContainer.style.display = 'block';
				
				// Initialize table
				updateTable(data);
			})
			.catch(error => {
				document.getElementById('loading').innerHTML = 'Error loading data: ' + error.message;
			});
	</script>
</body>
</html> 
